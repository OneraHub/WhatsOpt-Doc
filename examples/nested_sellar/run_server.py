# -*- coding: utf-8 -*-
"""
  run_server.py generated by WhatsOpt. 
"""
#!/usr/bin/env python

from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol
from thrift.server import TServer

from server.nested_sellar import NestedSellar as NestedSellarService
from server.nested_sellar_conversions import *
from nested_sellar import NestedSellarFactory as Factory

class NestedSellarHandler:
    server = None

    def __init__(self):
        factory = Factory()
        
        self.functions = factory.create_functions()
        
        self.sellar_disc1 = factory.create_sellar_disc1()
        
        self.sellar_disc2 = factory.create_sellar_disc2()
        

    # Admin interface
    def ping(self):
        print("Ping!")

    def shutdown(self):
        print("Shutting down NestedSellar server...")
        exit(0)

    # NestedSellar interface
    
    def compute_functions(self, ins):
        outputs = {}
        inputs = to_openmdao_functions_inputs(ins)
        self.functions.compute(inputs, outputs)
        return to_thrift_functions_output(outputs)
    
    def compute_sellar_disc1(self, ins):
        outputs = {}
        inputs = to_openmdao_sellar_disc1_inputs(ins)
        self.sellar_disc1.compute(inputs, outputs)
        return to_thrift_sellar_disc1_output(outputs)
    
    def compute_sellar_disc2(self, ins):
        outputs = {}
        inputs = to_openmdao_sellar_disc2_inputs(ins)
        self.sellar_disc2.compute(inputs, outputs)
        return to_thrift_sellar_disc2_output(outputs)
    


handler = NestedSellarHandler()
processor = NestedSellarService.Processor(handler)
transport = TSocket.TServerSocket('0.0.0.0', port=31400)
tfactory = TTransport.TBufferedTransportFactory()
pfactory = TBinaryProtocol.TBinaryProtocolFactory()

server = handler.server = TServer.TSimpleServer(processor, transport, tfactory, pfactory)

print("Starting NestedSellar analysis server...")
server.serve()
print("done!")
